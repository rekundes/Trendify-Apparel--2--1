<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Men – Trendify</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="men.css">
  <link rel="icon" href="img/logo.png" type="image/png">
</head>
<body>
  <header class="navbar">
    <div class="nav-container">
      <nav class="main-nav">
        <div class="dropdown">
          <input type="checkbox" id="men-toggle" class="toggle">
          <label for="men-toggle">MEN</label>
          <div class="dropdown-area">
            <div class="section">
              <label>CLOTHING</label>
              <div class="sub-menu">
                <a href="men.html?category=shirts">SHIRTS</a>
                <a href="men.html?category=jackets">JACKETS</a>
                <a href="men.html?category=jeans">JEANS</a>
              </div>
            </div>
            <div class="section">
              <label>ACCESSORIES</label>
              <div class="sub-menu">
                <a href="men.html?category=shoes">SHOES</a>
                <a href="men.html?category=bags">BAGS</a>
                <a href="men.html?category=jewelry">JEWELRY</a>
              </div>
            </div>
          </div>
        </div>
        <div class="dropdown">
          <input type="checkbox" id="women-toggle" class="toggle">
          <label for="women-toggle">WOMEN</label>
          <div class="dropdown-area">
            <div class="section">
              <label>CLOTHING</label>
              <div class="sub-menu">
                <a href="women.html?category=tops">TOPS</a>
                <a href="women.html?category=dresses">DRESSES</a>
                <a href="women.html?category=skirts">SKIRTS</a>
              </div>
            </div>
            <div class="section">
              <label>ACCESSORIES</label>
              <div class="sub-menu">
                <a href="women.html?category=heels">HEELS</a>
                <a href="women.html?category=bags">BAGS</a>
                <a href="women.html?category=jewelry">JEWELRY</a>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <a href="main.html">
        <img src="img/logo.png" class="logo">
      </a>
      <div class="nav-right">
        <a href="search.html"><i class="fa-solid fa-magnifying-glass"></i></a>
        <a href="sign-in.html"><i class="fa-regular fa-user"></i></a>
        <a href="cart.html" style="position:relative;">
          <i class="fa-solid fa-cart-shopping"></i>
          <span id="cart-counter" class="cart-count">0</span>
        </a>
      </div>
    </div>
  </header>

  <h1 class="category-title" id="categoryTitle">MEN</h1>

  <div class="product-grid" id="productGrid"></div>

  <section class="newsletter">
    <h3>10% off your next purchase by subscribing to the newsletter</h3>
    <form>
      <input type="email" placeholder="E-mail">
      <button type="submit">SIGN UP NOW</button>
      <p>By subscribing, you confirm that you have read the <a href="#">Privacy Policy</a>.</p>
    </form>
  </section>

  <footer>
    <div class="footer-grid">
      <div>
        <h4>CUSTOMER SERVICE</h4>
        <p><a href="#">Help</a></p>
        <p><a href="#">My Purchases</a></p>
        <p><a href="#">Returns</a></p>
      </div>
      <div>
        <h4>COMPANY</h4>
        <p><a href="#">About Us</a></p>
        <p><a href="#">Work for Trendify</a></p>
        <p><a href="#">Press</a></p>
      </div>
      <div>
        <h4>DISCOVER</h4>
        <p><a href="#">Responsibility</a></p>
        <p><a href="#">Stores</a></p>
        <p><a href="#">Site Map</a></p>
      </div>
      <div>
        <h4>FOLLOW US</h4>
        <p>Instagram · Facebook · YouTube</p>
        <p>TikTok · Spotify · Pinterest</p>
        <p>X · LinkedIn</p>
      </div>
      <div>
        <h4>LOCATION</h4>
        <p>PHILIPPINES ▼</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>
        <a href="#">Privacy Policy and Cookies</a> ·
        <a href="#">Terms and Conditions</a> ·
        <a href="#">Ethics Channel</a>
      </p>
      <p style="margin-top: 10px;">© 2025 Trendify. All rights reserved.</p>
    </div>
  </footer>

  <div id="hoverPreview" class="hover-preview" aria-hidden="true">
    <button type="button" class="hover-close-btn">✕</button>
    <div class="hover-image-wrapper">
      <img id="hoverPreviewImg" src="" alt="Product preview" />
      <div class="hover-price-badge" id="hoverPriceBadge">₱0</div>
    </div>
    <div class="hover-details">
      <div class="hover-size-row">
        <div class="hover-size-label">Size</div>
        <div class="hover-size-options size-options-clothing">
          <button class="size-chip">S</button>
          <button class="size-chip">M</button>
          <button class="size-chip active">L</button>
          <button class="size-chip">XL</button>
        </div>
        <select class="size-select-shoes">
          <option value="36">36</option>
          <option value="37">37</option>
          <option value="38">38</option>
          <option value="39">39</option>
          <option value="40">40</option>
          <option value="41">41</option>
          <option value="42">42</option>
          <option value="43">43</option>
          <option value="44">44</option>
          <option value="45">45</option>
        </select>
      </div>
      <div class="hover-qty-row">
        <div class="hover-qty-label">Quantity</div>
        <div class="hover-qty-controls">
          <button class="qty-btn minus">−</button>
          <span class="qty-value">1</span>
          <button class="qty-btn plus">+</button>
        </div>
      </div>
      <button type="button" class="hover-add-btn">Add to cart</button>
    </div>
  </div>

  <script>
    document.addEventListener("click", function(e) {
      const dropdowns = document.querySelectorAll(".dropdown");
      dropdowns.forEach(drop => {
        const toggle = drop.querySelector(".toggle");
        if (!drop.contains(e.target)) toggle.checked = false;
      });
    });

    const params = new URLSearchParams(window.location.search);
    const category = params.get("category") || "shirts";
    const categoryTitle = document.getElementById("categoryTitle");
    const productGrid = document.getElementById("productGrid");

    const categories = {
      shirts: [
        { img: "img/img/img/men-shirt1.jpg", name: "Enigma 8-Ball", price: "₱299" },
        { img: "img/img/img/men-shirt2.jpg", name: "Enigma Eyes That Peak", price: "₱299" },
        { img: "img/img/img/men-shirt3.jpg", name: "Universe", price: "₱299" },
        { img: "img/img/img/men-shirt4.jpg", name: "Chicago 23", price: "₱399" },
        { img: "img/img/img/men-shirt5.jpg", name: "Death riot", price: "₱499" },
        { img: "img/img/img/men-shirt6.jpg", name: "Porche 911", price: "₱299" }
      ],
      jackets: [
        { img: "img/img/img/men-jacket1.jpg", name: "Ferrari", price: "₱899" },
        { img: "img/img/img/men-jacket2.jpg", name: "Srel", price: "₱999" },
        { img: "img/img/img/men-jacket3.jpg", name: "Sincere", price: "₱799" },
        { img: "img/img/img/men-jacket4.jpg", name: "Cartier", price: "₱699" },
        { img: "img/img/img/men-jacket5.jpg", name: "Tokyo Japan", price: "₱899" },
        { img: "img/img/img/men-jacket6.jpg", name: "New York", price: "₱749" }
      ],
      jeans: [
        { img: "img/img/img/men-jeans1.jpg", name: "Skull", price: "₱799" },
        { img: "img/img/img/men-jeans2.jpg", name: "Techwear", price: "₱899" },
        { img: "img/img/img/men-jeans3.jpg", name: "BAGGY", price: "₱499" },
        { img: "img/img/img/men-jeans4.jpg", name: "CARGO", price: "₱599" },
        { img: "img/img/img/men-jeans5.jpg", name: "BLUE JEANS", price: "₱399" },
        { img: "img/img/img/men-jeans6.jpg", name: "WHITE CARGO", price: "₱499" }
      ],
      shoes: [
        { img: "img/img/img/men-shoes1.jpg", name: "Nike Air Jordan 1 Retro High OG", price: "₱3,495" },
        { img: "img/img/img/men-shoes2.jpg", name: "Jordan 4 Retro off-white", price: "₱2,995" },
        { img: "img/img/img/men-shoes3.jpg", name: "Chuck taylor all-star", price: "₱2,495" },
        { img: "img/img/img/men-shoes4.jpg", name: "Onitsuka tiger", price: "₱4,595" },
        { img: "img/img/img/men-shoes5.jpg", name: "Black Puma Speedcat", price: "₱1,995" },
        { img: "img/img/img/men-shoes6.jpg", name: "ADIDAS SUPERSTAR", price: "₱3,895" }
      ],
      bags: [
        { img: "img/img/img/men-bag1.jpg", name: "CrossBODY bag", price: "₱2,995" },
        { img: "img/img/img/men-bag2.jpg", name: "Louis Vuitton", price: "₱3,495" },
        { img: "img/img/img/men-bag3.jpg", name: "Supreme", price: "₱2,495" },
        { img: "img/img/img/men-bag4.jpg", name: "Prada x Adidas", price: "₱3,995" },
        { img: "img/img/img/men-bag5.jpg", name: "Nike backpack", price: "₱1,495" },
        { img: "img/img/img/men-bag6.jpg", name: "Bape backpack", price: "₱4,295" }
      ],
      jewelry: [
        { img: "img/img/img/men-accessories1.jpg", name: "Chain Necklace", price: "₱795" },
        { img: "img/img/img/men-accessories2.jpg", name: "Bracelet", price: "₱695" },
        { img: "img/img/img/men-accessories3.jpg", name: "Watch", price: "₱895" },
        { img: "img/img/img/men-accessories4.jpg", name: "Earring", price: "₱595" },
        { img: "img/img/img/men-accessories5.jpg", name: "Ring", price: "₱1,195" },
        { img: "img/img/img/men-accessories6.jpg", name: "Sun glasses", price: "₱495" }
      ]
    };

    categoryTitle.textContent = category.replace("-", " ").toUpperCase();
    const hoverPreview = document.getElementById('hoverPreview');
    const hoverPreviewImg = document.getElementById('hoverPreviewImg');
    const hoverPriceBadge = document.getElementById('hoverPriceBadge');
    const hoverCloseBtn = document.querySelector('.hover-close-btn');
    const hoverSizeRow = document.querySelector('.hover-size-row');
    const sizeOptionsClothing = document.querySelector('.size-options-clothing');
    const sizeSelectShoes = document.querySelector('.size-select-shoes');
    const noSizeCategories = ['bags', 'jewelry'];
    const shoeCategory = 'shoes';

    function updateSizeUIForCategory() {
      if (!hoverSizeRow) return;
      if (noSizeCategories.includes(category)) {
        hoverSizeRow.style.display = 'none';
      } else {
        hoverSizeRow.style.display = 'flex';
        if (category === shoeCategory) {
          if (sizeOptionsClothing) sizeOptionsClothing.style.display = 'none';
          if (sizeSelectShoes) sizeSelectShoes.style.display = 'inline-block';
        } else {
          if (sizeOptionsClothing) sizeOptionsClothing.style.display = 'flex';
          if (sizeSelectShoes) sizeSelectShoes.style.display = 'none';
        }
      }
    }
    updateSizeUIForCategory();

    let html = '';
    categories[category].forEach(item => {
      const badgeHtml = item.isNew ? `<div class="badge">New</div>` : '';
      html += `
        <div class="product-card">
          ${badgeHtml}
          <img src="${item.img}" class="primary-img">
          <img src="${item.secondaryImg || item.img}" class="secondary-img">
          <div class="product-info">
            <div class="product-name">${item.name}</div>
            <div class="product-price">${item.price}</div>
          </div>
        </div>
      `;
    });
    productGrid.innerHTML = html;

    const cards = productGrid.querySelectorAll('.product-card');
    cards.forEach((card, idx) => {card.dataset.index = idx;
      const item = categories[category][idx];
      card.addEventListener('click', () => {
        if (!hoverPreview || !hoverPreviewImg || !hoverPriceBadge) return;
        hoverPreviewImg.src = item.img;
        hoverPriceBadge.textContent = item.price;
        hoverPreview.classList.add('show');
        hoverPreview.setAttribute('aria-hidden', 'false');
        hoverPreview.dataset.name = item.name;
        hoverPreview.dataset.price = item.price;
        hoverPreview.dataset.img = item.img;
      });
    });

    hoverCloseBtn.addEventListener('click', () => {
      hoverPreview.classList.remove('show');
      hoverPreviewImg.src = '';
      hoverPreview.setAttribute('aria-hidden', 'true');
    });

    const sizeChips = document.querySelectorAll('.size-chip');
    let selectedSize = 'L';
    sizeChips.forEach(chip => {
      chip.addEventListener('click', () => {
        sizeChips.forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        selectedSize = chip.textContent.trim();
      });
    });

    const qtyValue = document.querySelector('.qty-value');
    const qtyMinus = document.querySelector('.qty-btn.minus');
    const qtyPlus = document.querySelector('.qty-btn.plus');
    let quantity = 1;

    function renderQty() { qtyValue.textContent = quantity; }
    qtyMinus.addEventListener('click', () => { if (quantity > 1) { quantity--; renderQty(); } });
    qtyPlus.addEventListener('click', () => { quantity++; renderQty(); });
    renderQty();

    const addBtn = document.querySelector('.hover-add-btn');

addBtn.addEventListener('click', () => {
  // 1. Check Login Status
  if (localStorage.getItem('userLoggedIn') !== 'true') {
    const msg = document.createElement('div');
    msg.textContent = '⚠️ Please sign in first!';
    Object.assign(msg.style, {
      position: 'fixed', bottom: '20px', right: '20px',
      backgroundColor: '#f44336', color: 'white', padding: '12px 20px',
      borderRadius: '8px', boxShadow: '0 2px 6px rgba(0,0,0,0.3)', zIndex: 9999
    });
    document.body.appendChild(msg);
    
    setTimeout(() => {
      msg.remove();
      const currentUrl = encodeURIComponent(window.location.href);
      window.location.href = `sign-in.html?next=${currentUrl}`;
    }, 1500);
    return;
  }

  // 2. Collect Product Data
  const preview = document.getElementById('hoverPreview');
  const name = preview.dataset.name || '';
  const price = preview.dataset.price || '';
  const img = preview.dataset.img || '';
  const qty = parseInt(document.querySelector('.qty-value').textContent) || 1;
  const idx = preview.dataset.index; // Ensure your click handler sets this!

  let sizeToSave = noSizeCategories.includes(category) 
    ? 'One size' 
    : (category === shoeCategory ? sizeSelectShoes.value : selectedSize);

  // 3. Send to Backend
  fetch("add_to_cart.php", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, price, img, size: sizeToSave, qty })
  })
  .then(res => res.status === 401 ? (window.location.href = "sign-in.html") : res.json())
  .then(data => {
    if (data && data.success) {
      // Success Notification
      const successMsg = document.createElement('div');
      successMsg.textContent = '✅ Added to cart!';
      Object.assign(successMsg.style, {
        position: 'fixed', bottom: '20px', right: '20px',
        background: '#4caf50', color: 'white', padding: '12px 20px',
        borderRadius: '8px', zIndex: 9999
      });
      document.body.appendChild(successMsg);
      setTimeout(() => successMsg.remove(), 2000);

      // UI Updates
      updateCartCounter();
      preview.classList.remove('show');
      preview.setAttribute('aria-hidden', 'true');

      // Optional: Visual feedback on the product card
      const card = document.querySelector(`.product-card[data-index="${idx}"]`);
      if (card) {
        card.style.opacity = "0.5"; // Grey out instead of removing?
        // card.remove(); // Only use if you want the item to disappear
      }
    }
  })
  .catch(err => console.error("Error:", err));
}); // Added the missing closing bracket here!

function updateCartCounter() {
  const counter = document.getElementById('cart-counter');
  fetch("get_cart.php")
    .then(res => res.json())
    .then(cart => {
      // Calculate total quantity of items
      const total = cart.reduce((sum, item) => sum + parseInt(item.qty || 0), 0);
      if (!counter) return;
      counter.innerText = total;
      counter.style.display = total > 0 ? 'flex' : 'none';
    })
    .catch(err => console.warn("Cart counter error:", err));
}

// Initial call to set counter on page load
updateCartCounter();
  </script>
</body>
</html>