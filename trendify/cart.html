<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shopping Bag – Trendify</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="cart.css">
</head>

<body>
  <!-- HEADER -->
  <header class="navbar">
    <div class="nav-container">
      <nav class="main-nav">
        <!-- MEN -->
        <div class="dropdown">
          <input type="checkbox" id="men-toggle" class="toggle">
          <label for="men-toggle">MEN</label>
          <div class="dropdown-area">
            <div class="section">
              <label>CLOTHING</label>
              <div class="sub-menu">
                <a href="men.html?category=shirts">SHIRTS</a>
                <a href="men.html?category=jackets">JACKETS</a>
                <a href="men.html?category=jeans">JEANS</a>
              </div>
            </div>
            <div class="section">
              <label>ACCESSORIES</label>
              <div class="sub-menu">
                <a href="men.html?category=shoes">SHOES</a>
                <a href="men.html?category=bags">BAGS</a>
                <a href="men.html?category=jewelry">JEWELRY</a>
              </div>
            </div>
          </div>
        </div>

        <!-- WOMEN -->
        <div class="dropdown">
          <input type="checkbox" id="women-toggle" class="toggle">
          <label for="women-toggle">WOMEN</label>
          <div class="dropdown-area">
            <div class="section">
              <label>CLOTHING</label>
              <div class="sub-menu">
                <a href="women.html?category=tops">TOPS</a>
                <a href="women.html?category=dresses">DRESSES</a>
                <a href="women.html?category=skirts">SKIRTS</a>
              </div>
            </div>
            <div class="section">
              <label>SHOES & ACCESSORIES</label>
              <div class="sub-menu">
                <a href="women.html?category=heels">HEELS</a>
                <a href="women.html?category=bags">BAGS</a>
                <a href="women.html?category=jewelry">JEWELRY</a>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
        body { background: #fff; }

        /* HEADER */
        .navbar {
          position: sticky;
          top: 0;
          z-index: 9999;
          background: #fff;
          padding: 14px 40px;
          border-bottom: 1px solid #e7e7e7;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        .nav-container {
          width: 100%;
          max-width: 1400px;
          display: grid;
          grid-template-columns: 1fr auto 1fr;
          align-items: center;
        }
        .main-nav { display: flex; align-items: center; gap: 35px; }
        .main-nav label, .main-nav a {
          font-size: 18px;
          font-weight: bold;
          letter-spacing: 1px;
          text-decoration: none;
          color: #000;
          cursor: pointer;
        }
        .logo { width: 70px; display: block; margin: 0 auto; }
        .nav-right {
          display: flex;
          justify-content: flex-end;
          align-items: center;
          gap: 22px;
        }
        .nav-right i { font-size: 22px; color: #000; cursor: pointer; }
        .cart-count {
          position: absolute;
          top: -6px;
          right: -10px;
          background: #000;
          color: #fff;
          border-radius: 999px;
          font-size: 11px;
          padding: 2px 6px;
          display: none;
        }

        /* DROPDOWN */
        .dropdown { position: relative; }
        .toggle { display: none; }
        .toggle:checked + label + .dropdown-area { display: flex; }
        .dropdown-area {
          position: absolute;
          top: 100%;
          left: 0;
          width: 260px;
          background: #fff;
          border-right: 1px solid #ddd;
          padding: 25px 20px 25px 20px;
          padding-right: 35px;
          display: none;
          flex-direction: column;
          gap: 22px;
          box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        .section label {
          font-size: 15px;
          font-weight: bold;
          text-transform: uppercase;
          cursor: pointer;
        }
        .sub-menu {
          display: none;
          flex-direction: column;
          gap: 8px;
          margin-top: 8px;
          padding-left: 12px;
          border-left: 2px solid #000;
        }
        .section:hover .sub-menu { display: flex; }
        .sub-menu a {
          font-size: 14px;
          font-weight: bold;
          text-transform: uppercase;
          color: #000;
          text-decoration: none;
        }
        .sub-menu a:hover { opacity: 0.7; }

        /* EMPTY CART MESSAGE */
        .cart-empty {
          text-align: center;
          padding: 60px 20px 30px;
        }
        .cart-empty h2 {
          font-size: 26px;
          margin-bottom: 10px;
          letter-spacing: 1px;
        }
        .cart-empty p { font-size: 16px; margin-bottom: 25px; }
        .cart-empty a {
          display: inline-block;
          padding: 14px 28px;
          background: #000;
          color: #fff;
          font-size: 15px;
          text-decoration: none;
          border-radius: 4px;
        }

        /* CART ITEMS PANEL */
        .cart-items {
          max-width: 900px;
          margin: 20px auto 10px;
          padding: 20px 24px 80px;
          border-radius: 14px;
          box-shadow: 0 14px 40px rgba(0,0,0,0.06);
          background: #fff;
        }
        .cart-title {
          font-size: 24px;
          font-weight: 700;
          margin-bottom: 10px;
        }
        .cart-group-header {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 14px;
          font-weight: 600;
          margin: 10px 0 6px;
        }
        .cart-group-pill {
          display: inline-block;
          padding: 4px 10px;
          border-radius: 999px;
          border: 1px solid #000;
          font-size: 11px;
          text-transform: uppercase;
        }
        .cart-item-row {
          display: grid;
          grid-template-columns: auto 80px 1fr auto;
          gap: 14px;
          padding: 10px 0 14px;
          border-bottom: 1px solid #eee;
          align-items: center;
        }
        .cart-item-select {
          display: flex;
          justify-content: center;
        }
        .cart-item-thumb {
          width: 72px;
          height: 72px;
          border-radius: 8px;
          overflow: hidden;
          background: #f4f4f4;
        }
        .cart-item-thumb img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
        .cart-item-main {
          display: flex;
          flex-direction: column;
          gap: 4px;
        }
        .cart-item-name {
          font-size: 14px;
          font-weight: 600;
        }
        .cart-item-meta {
          font-size: 12px;
          color: #666;
        }
        .cart-item-qty {
          display: flex;
          flex-direction: column;
          align-items: flex-end;
          gap: 8px;
        }
        .cart-qty-controls {
          display: inline-flex;
          align-items: center;
          gap: 10px;
          background: #111;
          padding: 6px 10px;
          border-radius: 12px;
        }
        .cart-qty-btn {
          width: 26px;
          height: 26px;
          border-radius: 8px;
          border: none;
          background: transparent;
          color: #fff;
          font-size: 16px;
          cursor: pointer;
        }
        .cart-qty-value {
          min-width: 24px;
          text-align: center;
          color: #fff;
          font-weight: 600;
        }
        .cart-remove-btn {
          margin-top: 6px;
          padding: 6px 10px;
          font-size: 12px;
          border-radius: 8px;
          border: 1px solid #ccc;
          background: #fff;
          cursor: pointer;
        }

        /* Checkout bar */
        .checkout-bar {
          position: sticky;
          bottom: 0;
          left: 0;
          right: 0;
          background: #fff;
          border-top: 1px solid #eee;
          padding: 12px 16px;
          display: none;
          align-items: center;
          justify-content: space-between;
          gap: 16px;
          z-index: 50;
        }
        .checkout-info {
          display: flex;
          align-items: center;
          gap: 10px;
          font-size: 14px;
        }
        .checkout-total {
          margin-left: auto;
          display: flex;
          align-items: center;
          gap: 12px;
          font-weight: 700;
        }
        .checkout-btn {
          padding: 10px 20px;
          border-radius: 999px;
          border: none;
          background: #000;
          color: #fff;
          font-weight: 700;
          cursor: pointer;
        }
        .checkout-btn:disabled {
          opacity: .4;
          cursor: default;
        }

        /* NEWSLETTER */
        .newsletter {
          padding: 60px 20px;
          text-align: center;
          border-top: 1px solid #eee;
        }
        .newsletter h3 { font-size: 20px; margin-bottom: 15px; }
        .newsletter form {
          max-width: 400px;
          margin: 0 auto;
        }
        .newsletter input {
          width: 100%;
          padding: 12px;
          font-size: 15px;
          border: 1px solid #ccc;
          border-radius: 4px;
          margin-bottom: 10px;
        }
        .newsletter button {
          width: 100%;
          padding: 12px;
          background: #000;
          color: #fff;
          font-size: 15px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }
        .newsletter p { font-size: 13px; margin-top: 10px; }

        /* FOOTER */
        footer {
          padding: 40px 20px;
          background: #f9f9f9;
          border-top: 1px solid #ddd;
          font-size: 14px;
          color: #333;
        }
        .footer-grid {
          max-width: 1200px;
          margin: 0 auto;
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
          gap: 25px;
        }
        .footer-grid h4 { font-weight: bold; margin-bottom: 10px; }
        .footer-bottom {
          text-align: center;
          margin-top: 30px;
          font-size: 13px;
          color: #666;
        }
        .footer-bottom a {
          text-decoration: none;
          color: #666;
        }
      </style>

      <a href="main.html">
        <img src="img/logo.png" class="logo" alt="">
      </a>

      <div class="nav-right">
        <a href="search.html"><i class="fa-solid fa-magnifying-glass"></i></a>
        <a href="sign-in.html"><i class="fa-regular fa-user"></i></a>
        <a href="cart.html" style="position:relative;">
          <i class="fa-solid fa-cart-shopping"></i>
          <span id="cart-counter" class="cart-count">0</span>
        </a>
      </div>
    </div>
  </header>

  <!-- CART CONTENT -->
  <main class="cart-page">
    <!-- VISIBLE WHEN CART HAS ITEMS -->
    <section id="cartItemsSection" class="cart-items" style="display:none;">
      <h1 class="cart-title">Shopping bag</h1>
      <div id="cartItemsList"></div>
    </section>

    <!-- Checkout bar -->
    <div id="checkoutBar" class="checkout-bar">
      <div class="checkout-info">
        <label>
          <input type="checkbox" id="selectAllCart">
          Select all
        </label>
        <span id="checkoutCount">0 item</span>
      </div>
      <div class="checkout-total">
        Total: <span id="checkoutTotal">₱0</span>
        <button id="checkoutBtn" class="checkout-btn" disabled>Check out</button>
      </div>
    </div>

    <!-- VISIBLE WHEN CART IS EMPTY -->
    <section class="cart-empty">
      <h2>YOUR SHOPPING BAG IS EMPTY</h2>
      <p>Get inspiration for your new wardrobe from the latest looks</p>
      <a href="main.html">SEE WHAT'S NEW</a>
    </section>

    <!-- NEWSLETTER -->
    <section class="newsletter">
      <h3>10% off your next purchase by subscribing to the newsletter</h3>
      <form>
        <input type="email" placeholder="E-mail">
        <button type="submit">SIGN UP NOW</button>
        <p>By subscribing, you confirm that you have read the <a href="#">Privacy Policy</a>.</p>
      </form>
    </section>

    <!-- FOOTER -->
    <footer>
      <div class="footer-grid">
        <div>
          <h4>CUSTOMER SERVICE</h4>
          <p><a href="#">Help</a></p>
          <p><a href="#">My Purchases</a></p>
          <p><a href="#">Returns</a></p>
        </div>
        <div>
          <h4>COMPANY</h4>
          <p><a href="#">About Us</a></p>
          <p><a href="#">Work for Trendify</a></p>
          <p><a href="#">Press</a></p>
        </div>
        <div>
          <h4>DISCOVER</h4>
          <p><a href="#">Responsibility</a></p>
          <p><a href="#">Stores</a></p>
          <p><a href="#">Site Map</a></p>
        </div>
        <div>
          <h4>FOLLOW US</h4>
          <p>Instagram · Facebook · YouTube</p>
          <p>TikTok · Spotify · Pinterest</p>
          <p>X · LinkedIn</p>
        </div>
        <div>
          <h4>LOCATION</h4>
          <p>PHILIPPINES ▼</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>
          <a href="#">Privacy Policy and Cookies</a> ·
          <a href="#">Terms and Conditions</a> ·
          <a href="#">Ethics Channel</a>
        </p>
        <p style="margin-top: 10px;">© 2025 Trendify. All rights reserved.</p>
      </div>
    </footer>

  </main>

  <script>
// ---------------- LOGIN CHECK ----------------
function checkLogin() {
  // Example: assume login info is stored in localStorage as "userLoggedIn"
  const isLoggedIn = localStorage.getItem("userLoggedIn") === "true";

  if (!isLoggedIn) {
    alert("Please log in to access your cart.");
    // Optionally clear UI before redirect
    const section = document.getElementById("cartItemsSection");
    const emptyEl = document.querySelector(".cart-empty");
    const checkoutBar = document.getElementById("checkoutBar");
    const counter = document.getElementById("cart-counter");

    if(section) section.style.display = "none";
    if(emptyEl) emptyEl.style.display = "block";
    if(checkoutBar) checkoutBar.style.display = "none";
    if(counter) {
      counter.innerText = "0";
      counter.style.display = "none";
    }

    window.location.href = "sign-in.html"; // redirect to login page
    return false;
  }
  return true;
}

// ---------------- CART LOGIC ----------------
document.addEventListener("DOMContentLoaded", () => {
  if (!checkLogin()) return; // stop loading cart if not logged in

  // Close dropdowns when clicking outside
  document.addEventListener("click", function(e) {
    document.querySelectorAll(".dropdown").forEach(drop => {
      const toggle = drop.querySelector(".toggle");
      if (!drop.contains(e.target)) toggle.checked = false;
    });
  });

  function parsePriceToNumber(p) {
    if (!p) return 0;
    return parseFloat(p.replace(/[₱,]/g, '')) || 0;
  }

  let selectedIds = new Set();
  let CART = [];

  // Update the cart icon counter
  function updateCartCounter() {
    fetch("get_cart.php")
      .then(res => res.json())
      .then(cart => {
        const counter = document.getElementById("cart-counter");
        const total = cart.reduce((s, i) => s + parseInt(i.quantity), 0);
        counter.innerText = total;
        counter.style.display = total > 0 ? "block" : "none";
      });
  }

  // Determine category labels
  function getCategoryLabel(item) {
    const n = (item.product_name || '').toLowerCase();
    if (n.includes("shirt")) return "Men shirts";
    if (n.includes("jacket")) return "Men jackets";
    if (n.includes("jeans")) return "Men jeans";
    if (n.includes("shoe")) return "Men shoes";
    if (n.includes("dress")) return "Women dresses";
    if (n.includes("top")) return "Women tops";
    if (n.includes("skirt")) return "Women skirts";
    if (n.includes("bag")) return "Bags";
    return "Trendify";
  }

  // Render the cart panel
  function renderCartItemsPanel() {
    fetch("get_cart.php")
      .then(res => res.json())
      .then(cart => {
        CART = cart;

        const section = document.getElementById("cartItemsSection");
        const listEl  = document.getElementById("cartItemsList");
        const emptyEl = document.querySelector(".cart-empty");
        const selectAll = document.getElementById("selectAllCart");

        listEl.innerHTML = "";

        if (cart.length === 0) {
          section.style.display = "none";
          emptyEl.style.display = "block";
          document.getElementById("checkoutBar").style.display = "none";
          updateCartCounter();
          return;
        }

        emptyEl.style.display = "none";
        section.style.display = "block";
        document.getElementById("checkoutBar").style.display = "flex";

        selectedIds = new Set(cart.map(i => i.id));

        cart.forEach(item => {
          const row = document.createElement("div");
          row.innerHTML = `
            <div class="cart-group-header">
              <span class="cart-group-pill">${getCategoryLabel(item)}</span>
            </div>
            <div class="cart-item-row">
              <div class="cart-item-select">
                <input type="checkbox" class="cart-check" data-id="${item.id}" checked>
              </div>
              <div class="cart-item-thumb">
                <img src="${item.image}">
              </div>
              <div class="cart-item-main">
                <div class="cart-item-name">${item.product_name}</div>
                <div class="cart-item-meta">₱${item.price} · ${item.size}</div>
              </div>
              <div class="cart-item-qty">
                <div class="cart-qty-controls">
                  <button class="cart-qty-btn minus">−</button>
                  <span class="cart-qty-value">${item.quantity}</span>
                  <button class="cart-qty-btn plus">+</button>
                </div>
                <button class="cart-remove-btn">Remove</button>
              </div>
            </div>
          `;

          // Checkbox logic
          row.querySelector(".cart-check").onchange = e => {
            if (e.target.checked) selectedIds.add(item.id);
            else selectedIds.delete(item.id);
            updateCheckoutSummary();
          };

          // Quantity buttons
          row.querySelector(".minus").onclick = () => {
            if (item.quantity > 1) updateQty(item.id, item.quantity - 1);
          };
          row.querySelector(".plus").onclick = () => {
            updateQty(item.id, item.quantity + 1);
          };

          // Remove item
          row.querySelector(".cart-remove-btn").onclick = () => {
            removeItem(item.id);
          };

          listEl.appendChild(row);
        });

        // Select all toggle
        selectAll.checked = true;
        selectAll.onchange = () => {
          if (selectAll.checked) {
            selectedIds = new Set(cart.map(i => i.id));
          } else {
            selectedIds.clear();
          }
          document.querySelectorAll(".cart-check").forEach(c => {
            c.checked = selectAll.checked;
          });
          updateCheckoutSummary();
        };

        updateCheckoutSummary();
        updateCartCounter();
      });
  }

  // Update quantity in DB
  function updateQty(id, qty) {
    fetch("update_cart_qty.php", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({id, quantity:qty})
    }).then(() => renderCartItemsPanel());
  }

  // Remove item from DB
  function removeItem(id) {
    fetch("remove_cart_item.php", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({id})
    }).then(() => renderCartItemsPanel());
  }

  // Update checkout summary
  function updateCheckoutSummary() {
    let total = 0, count = 0;
    CART.forEach(i => {
      if (selectedIds.has(i.id)) {
        total += parseFloat(i.price) * parseInt(i.quantity);
        count += parseInt(i.quantity);
      }
    });
    document.getElementById("checkoutTotal").innerText = "₱" + total.toLocaleString();
    document.getElementById("checkoutCount").innerText = count + (count===1?" item":" items");
    document.getElementById("checkoutBtn").disabled = count===0;
  }

  // Checkout button
  document.getElementById("checkoutBtn").onclick = () => {
    const selected = CART.filter(i => selectedIds.has(i.id));
    localStorage.setItem("trendify_checkout", JSON.stringify(selected));
    window.location.href = "checkout.html";
  };

  // Initial load
  updateCartCounter();
  renderCartItemsPanel();
});
</script>



</body>
</html>
