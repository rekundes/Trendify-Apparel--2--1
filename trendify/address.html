<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Addresses – Trendify</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="icon" href="img/logo.png" type="image/png">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{background:#fff;color:#000}

/* NAVBAR */
.navbar{position:sticky;top:0;z-index:9999;background:#fff;width:100%;padding:14px 40px;display:flex;justify-content:center;align-items:center;border-bottom:1px solid #e7e7e7}
.nav-container{width:100%;max-width:1400px;display:grid;grid-template-columns:1fr auto 1fr;align-items:center}
.main-nav{display:flex;align-items:center;gap:35px}
.main-nav label,.main-nav a{font-size:18px;font-weight:bold;letter-spacing:1px;text-decoration:none;color:#000;cursor:pointer}
.logo{width:70px;display:block;margin:0 auto}
.nav-right{display:flex;justify-content:flex-end;align-items:center;gap:22px}
.nav-right i{font-size:22px;color:#000;cursor:pointer}
.nav-right a{position:relative;color:#000;text-decoration:none}
.cart-count{position:absolute;top:-8px;right:-10px;background:red;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;border-radius:50%;display:none}

/* DROPDOWN */
.dropdown{position:relative}
.toggle{display:none}
.toggle:checked+label+.dropdown-area{display:flex}
.dropdown-area{position:absolute;top:100%;left:0;width:260px;background:#fff;border-right:1px solid #ddd;padding:25px 20px;display:none;flex-direction:column;gap:22px;box-shadow:0 4px 10px rgba(0,0,0,.08)}
.section label{font-size:15px;font-weight:bold;text-transform:uppercase;cursor:pointer}
.sub-menu{display:none;flex-direction:column;gap:8px;margin-top:8px;padding-left:12px;border-left:2px solid #000}
.section:hover .sub-menu{display:flex}
.sub-menu a{font-size:14px;font-weight:bold;text-transform:uppercase;color:#000;text-decoration:none}

/* CONTENT */
.container{max-width:420px;margin:70px auto;text-align:center}
.container h2{margin-bottom:10px}
.container p{font-size:14px;color:#666;margin-bottom:30px}

.form{display:flex;flex-direction:column;gap:14px}
.form input,.form select{padding:14px;border:1px solid #ccc;font-size:14px}
.form input[readonly]{background:#f3f3f3}

.btn{background:#000;color:#fff;border:none;padding:14px;font-weight:bold;cursor:pointer}

/* FOOTER */
footer{padding:40px 20px;background:#f9f9f9;border-top:1px solid #ddd;font-size:14px;color:#333;margin-top:80px}
.footer-grid{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:25px}
.footer-grid h4{font-weight:bold;margin-bottom:10px}
.footer-grid a{text-decoration:none;color:#333}
.footer-bottom{text-align:center;margin-top:30px;font-size:13px;color:#666}
</style>
</head>
<body>

<!-- HEADER / NAVBAR -->
<header class="navbar">
  <div class="nav-container">
    <nav class="main-nav">
      <!-- MEN DROPDOWN -->
      <div class="dropdown">
        <input type="checkbox" id="men-toggle" class="toggle">
        <label for="men-toggle">MEN</label>
        <div class="dropdown-area">
          <div class="section">
            <label>CLOTHING</label>
            <div class="sub-menu">
              <a href="men.html?category=shirts">SHIRTS</a>
              <a href="men.html?category=jackets">JACKETS</a>
              <a href="men.html?category=jeans">JEANS</a>
            </div>
          </div>
          <div class="section">
            <label>ACCESSORIES</label>
            <div class="sub-menu">
              <a href="men.html?category=shoes">SHOES</a>
              <a href="men.html?category=bags">BAGS</a>
              <a href="men.html?category=jewelry">JEWELRY</a>
            </div>
          </div>
        </div>
      </div>

      <!-- WOMEN DROPDOWN -->
      <div class="dropdown">
        <input type="checkbox" id="women-toggle" class="toggle">
        <label for="women-toggle">WOMEN</label>
        <div class="dropdown-area">
          <div class="section">
            <label>CLOTHING</label>
            <div class="sub-menu">
              <a href="women.html?category=tops">TOPS</a>
              <a href="women.html?category=dresses">DRESSES</a>
              <a href="women.html?category=skirts">SKIRTS</a>
            </div>
          </div>
          <div class="section">
            <label>SHOES & ACCESSORIES</label>
            <div class="sub-menu">
              <a href="women.html?category=heels">HEELS</a>
              <a href="women.html?category=bags">BAGS</a>
              <a href="women.html?category=jewelry">JEWELRY</a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- LOGO -->
    <a href="main.html"><img src="img/logo.png" class="logo"></a>

    <!-- RIGHT NAV: SEARCH, PROFILE, CART -->
    <div class="nav-right">
      <a href="sign-in.html" id="userLink"><i class="fa-regular fa-user"></i></a>
      <a href="cart.html"><i class="fa-solid fa-cart-shopping"></i><span class="cart-count" id="cartCount">0</span></a>
    </div>
  </div>
</header>

<!-- ADDRESS FORM CONTENT -->
<div class="container">
  <h2>MY ADDRESSES</h2>
  <p>You have not saved any delivery address yet. Add one now.</p>

  <form class="form" id="addressForm">
    <input type="text" id="firstName" placeholder="Name" required>
    <input type="text" id="lastName" placeholder="Surname" required>
    <input type="email" id="email" readonly>
    <input type="tel" id="mobile" placeholder="Mobile number" required>
    <input type="text" value="Philippines" readonly>
    <input type="text" id="address1" placeholder="Address" required>
    <input type="text" id="address2" placeholder="Address (line 2)">
    <input type="text" id="postcode" placeholder="Postcode" required>
    <input type="text" id="region" placeholder="Region" required>
    <input type="text" id="city" placeholder="Town / City" required>
    <button class="btn" type="submit">SAVE ADDRESS</button>
  </form>
</div>

<!-- FOOTER -->
<footer>
  <div class="footer-grid">
    <div>
      <h4>CUSTOMER SERVICE</h4>
      <p><a href="#">Help</a></p>
      <p><a href="#">Returns</a></p>
    </div>
    <div>
      <h4>COMPANY</h4>
      <p><a href="#">About Us</a></p>
      <p><a href="#">Press</a></p>
    </div>
    <div>
      <h4>DISCOVER</h4>
      <p><a href="#">Responsibility</a></p>
      <p><a href="#">Stores</a></p>
    </div>
    <div>
      <h4>FOLLOW US</h4>
      <p>Instagram · Facebook · TikTok</p>
    </div>
  </div>
  <div class="footer-bottom">© 2025 Trendify. All rights reserved.</div>
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const userLink = document.getElementById("userLink");

    // Check if user is logged in
    if (localStorage.getItem('userLoggedIn') === 'true') {
        userLink.href = "profile.html";
    } else {
        userLink.href = "sign-in.html";
    }

    // Get userId from localStorage
    let userId = parseInt(localStorage.getItem('userId'));
    const userEmail = localStorage.getItem('userEmail');

    if (!userId || isNaN(userId)) {
        alert("Please log in first");
        const returnUrl = encodeURIComponent(window.location.pathname);
        window.location.href = "sign-in.html?next=" + returnUrl;
        return;
    }

    // Pre-fill email
    if (userEmail) {
        document.getElementById('email').value = userEmail;
    }
});

// Close dropdowns if clicking outside
document.addEventListener("click", function(e) {
    const dropdowns = document.querySelectorAll(".dropdown");
    dropdowns.forEach(drop => {
        const toggle = drop.querySelector(".toggle");
        if (!drop.contains(e.target)) toggle.checked = false;
    });
});

// Save address form
document.getElementById('addressForm').addEventListener('submit', async e => {
    e.preventDefault();

    let userId = parseInt(localStorage.getItem('userId'));
    if (!userId || isNaN(userId)) {
        alert("User not logged in or invalid ID");
        return;
    }

    const data = {
        user_id: userId,
        email: document.getElementById('email').value,
        first_name: document.getElementById('firstName').value,
        last_name: document.getElementById('lastName').value,
        mobile: document.getElementById('mobile').value,
        country: "Philippines",
        address1: document.getElementById('address1').value,
        address2: document.getElementById('address2').value,
        postcode: document.getElementById('postcode').value,
        region: document.getElementById('region').value,
        city: document.getElementById('city').value
    };

    console.log("Sending address data:", data); // debug

    try {
        const res = await fetch('save_addresses.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const json = await res.json();
        if (json.success) {
            alert('Address saved successfully');
            document.getElementById('addressForm').reset();
            document.getElementById('email').value = localStorage.getItem('userEmail');
        } else {
            alert('Failed to save address: ' + (json.error || 'Unknown error'));
        }
    } catch (err) {
        console.error(err);
        alert('Failed to save address: network error');
    }
});
</script>

</body>
</html>
